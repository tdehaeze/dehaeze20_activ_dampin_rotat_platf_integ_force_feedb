#+TITLE: Active Damping of Rotating Positioning Platforms
:DRAWER:
#+LATEX_CLASS: ISMA_USD2020
#+OPTIONS: toc:nil
#+STARTUP: overview

#+DATE:
#+AUTHOR:

#+LATEX_HEADER_EXTRA: \author[1,3] {T. Dehaeze}
#+LATEX_HEADER_EXTRA: \author[1,2] {C. Collette}

#+LATEX_HEADER_EXTRA: \affil[1] {Precision Mechatronics Laboratory\NewLineAffil University of Liege, Belgium \NewAffil}
#+LATEX_HEADER_EXTRA: \affil[2] {BEAMS Department\NewLineAffil Free University of Brussels, Belgium \NewAffil}
#+LATEX_HEADER_EXTRA: \affil[3] {European Synchrotron Radiation Facility \NewLineAffil Grenoble, France e-mail: \textbf{thomas.dehaeze@esrf.fr}}

#+LATEX_HEADER_EXTRA: \bibliographystyle{IEEEtran}

#+LATEX_HEADER: \usepackage{amsmath,amssymb,amsfonts, cases}
#+LATEX_HEADER: \usepackage{algorithmic, graphicx, textcomp}
#+LATEX_HEADER: \usepackage{xcolor, import, hyperref}
#+LATEX_HEADER: \usepackage{subcaption}
#+LATEX_HEADER: \usepackage[USenglish]{babel}

#+LATEX_HEADER_EXTRA: \usepackage{tikz}
#+LATEX_HEADER_EXTRA: \usetikzlibrary{shapes.misc}

#+LATEX_HEADER: \setcounter{footnote}{1}
#+LATEX_HEADER: \input{config.tex}
:END:

* LaTeX Config                                                      :noexport:
#+begin_src latex :tangle config.tex

#+end_src

* Build                                                             :noexport:
#+NAME: startblock
#+BEGIN_SRC emacs-lisp :results none
  (add-to-list 'org-latex-classes
               '("ISMA_USD2020"
                 "\\documentclass{ISMA_USD2020}"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}"))
               )
#+END_SRC

* Abstract                                                            :ignore:
#+BEGIN_EXPORT latex
\abstract{
    Abstract text to be done
}
#+END_EXPORT

* Introduction
<<sec:introduction>>
** Establish the importance of the research topic                    :ignore:
# Active Damping + Rotating System

Controller Poles are shown by black crosses (
\begin{tikzpicture} \node[cross out, draw=black, minimum size=1ex, line width=2pt, inner sep=0pt, outer sep=0pt] at (0, 0){}; \end{tikzpicture}
).

** Applications of active damping                                    :ignore:
# Link to previous paper / tomography

# Such as the Nano-Active-Stabilization-System currently in development at the ESRF cite:dehaeze18_sampl_stabil_for_tomog_exper.

** Current active damping techniques                                 :ignore:
# IFF, DVF

** Describe a gap in the research                                    :ignore:
# No literature on rotating systems => gyroscopic effects

** Describe the paper itself / the problem which is addressed        :ignore:

** Introduce Each part of the paper                                  :ignore:

This paper has been published
The Matlab code that was use to obtain the results are available in cite:dehaeze20_activ_dampin_rotat_posit_platf.

* Dynamics of Rotating Positioning Platforms
** Studied Rotating Positioning Platform
# Simplest system where gyroscopic forces can be studied
Consider the rotating X-Y stage of Figure [[fig:system]].

# Present the system, parameters, assumptions

# Explain the frames (inertial frame x,y, rotating frame u,v)
# iu, iv is linked to the rotating stage and supposed to be perfect

# Small displacements

# Constant rotational speed

- $k$: Actuator's Stiffness [N/m]
- $m$: Payload's mass [kg]
- $\Omega = \dot{\theta}$: rotation speed [rad/s]
- $F_u$, $F_v$
- $d_u$, $d_v$

#+name: fig:system
#+caption: Schematic of the studied System
#+attr_latex: :scale 1
[[file:figs/system.pdf]]

# #+name: fig:cedrat_xy25xs
# #+caption: Figure caption
# #+attr_latex: :width 0.5\linewidth
# [[file:figs/cedrat_xy25xs.jpg]]

** Equation of Motion
The system has two degrees of freedom and is thus fully described by the generalized coordinates $u$ and $v$ (describing the position of the mass in the rotating frame).

Let's express the kinetic energy $T$ and the potential energy $V$ of the mass $m$ (neglecting the rotational energy):

Dissipation function $R$
Kinetic energy $T$
Potential energy $V$
\begin{subequations}
  \begin{align}
    T & = \frac{1}{2} m \left( \left( \dot{u} - \Omega v \right)^2 + \left( \dot{v} + \Omega u \right)^2 \right) \\
    R & = \frac{1}{2} c \left( \dot{u}^2 + \dot{v}^2 \right) \\
    V & = \frac{1}{2} k \left( u^2 + v^2 \right)
  \end{align}
\end{subequations}

The Lagrangian is the kinetic energy minus the potential energy:
\begin{equation}
L = T - V
\end{equation}

From the Lagrange's equations of the second kind, the equation of motion is obtained ($q_1 = u$, $q_2 = v$).
\begin{equation}
  \frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q}_i} \right) + \frac{\partial D}{\partial \dot{q}_i} - \frac{\partial L}{\partial q_i} = Q_i
\end{equation}
with $Q_i$ is the generalized force associated with the generalized variable $q_i$ ($Q_1 = F_u$ and $Q_2 = F_v$).


\begin{subequations}
  \begin{align}
    m \ddot{u} + c \dot{u} + ( k - m \Omega ) u &= F_u + 2 m \Omega \dot{v} \\
    m \ddot{v} + c \dot{v} + ( k \underbrace{-\,m \Omega}_{\text{Centrif.}} ) v &= F_v \underbrace{-\,2 m \Omega \dot{u}}_{\text{Coriolis}}
  \end{align}
\end{subequations}

# Explain Gyroscopic effects
- Coriolis Forces: coupling
- Centrifugal forces: negative stiffness

Without the coupling terms, each equation is the equation of a one degree of freedom mass-spring system with mass $m$ and stiffness $k- m\dot{\theta}^2$.
Thus, the term $- m\dot{\theta}^2$ acts like a negative stiffness (due to *centrifugal forces*).


** Transfer Functions in the Laplace domain

# Laplace Domain
\begin{subequations}
  \begin{align}
    u &= \frac{ms^2 + cs + k - m \Omega^2}{\left( m s^2 + cs + k - m \Omega^2 \right)^2 + \left( 2 m \Omega s \right)^2} F_u +  \frac{2 m \Omega s}{\left( m s^2 + cs + k - m \Omega^2 \right)^2 + \left( 2 m \Omega s \right)^2} F_v \\
    v &= \frac{-2 m \Omega s}{\left( m s^2 + cs + k - m \Omega^2 \right)^2 + \left( 2 m \Omega s \right)^2} F_u +  \frac{ms^2 + cs + k - m \Omega^2}{\left( m s^2 + cs + k - m \Omega^2 \right)^2 + \left( 2 m \Omega s \right)^2} F_v
  \end{align}
\end{subequations}

# Change of variables
\begin{equation}
\begin{bmatrix} d_u \\ d_v \end{bmatrix} =
\bm{G}_d
\begin{bmatrix} F_u \\ F_v \end{bmatrix}
\end{equation}
Where $\bm{G}_d$ is a $2 \times 2$ transfer function matrix.

\begin{equation}
\bm{G}_d = \frac{1}{k} \frac{1}{G_{dp}}
\begin{bmatrix}
   G_{dz} & G_{dc} \\
  -G_{dc} & G_{dz}
\end{bmatrix}
\end{equation}
With:
\begin{subequations}
  \begin{align}
    G_{dp} &= \left( \frac{s^2}{{\omega_0}^2} + 2 \xi \frac{s}{\omega_0} + 1 - \frac{{\Omega}^2}{{\omega_0}^2} \right)^2 + \left( 2 \frac{\Omega}{\omega_0} \frac{s}{\omega_0} \right)^2 \\
    G_{dz} &= \frac{s^2}{{\omega_0}^2} + 2 \xi \frac{s}{\omega_0} + 1 - \frac{{\Omega}^2}{{\omega_0}^2} \\
    G_{dc} &= 2 \frac{\Omega}{\omega_0} \frac{s}{\omega_0}
  \end{align}
\end{subequations}

- $\omega_0 = \sqrt{\frac{k}{m}}$: Natural frequency of the mass-spring system in $\si{\radian/\s}$
- $\xi$ damping ratio


** Constant Rotational Speed
To simplify, let's consider a constant rotational speed $\dot{\theta} = \Omega$ and thus $\ddot{\theta} = 0$.

#+NAME: eq:coupledplant
\begin{equation}
\begin{bmatrix} d_u \\ d_v \end{bmatrix} =
\frac{1}{(m s^2 + (k - m{\omega_0}^2))^2 + (2 m {\omega_0} s)^2}
\begin{bmatrix}
  ms^2 + (k-m{\omega_0}^2) & 2 m \omega_0 s \\
  -2 m \omega_0 s          & ms^2 + (k-m{\omega_0}^2) \\
\end{bmatrix}
\begin{bmatrix} F_u \\ F_v \end{bmatrix}
\end{equation}

# Explain each term

#+NAME: eq:coupled_plant
\begin{equation}
\begin{bmatrix} d_u \\ d_v \end{bmatrix} =
\frac{\frac{1}{k}}{\left( \frac{s^2}{{\omega_0}^2} + (1 - \frac{{\Omega}^2}{{\omega_0}^2}) \right)^2 + \left( 2 \frac{{\Omega} s}{{\omega_0}^2} \right)^2}
\begin{bmatrix}
  \frac{s^2}{{\omega_0}^2} + 1 - \frac{{\Omega}^2}{{\omega_0}^2} & 2 \frac{\Omega s}{{\omega_0}^2} \\
  -2 \frac{\Omega s}{{\omega_0}^2}          & \frac{s^2}{{\omega_0}^2} + 1 - \frac{{\Omega}^2}{{\omega_0}^2} \\
\end{bmatrix}
\begin{bmatrix} F_u \\ F_v \end{bmatrix}
\end{equation}

When the rotation speed is null, the coupling terms are equal to zero and the diagonal terms corresponds to one degree of freedom mass spring system.
#+NAME: eq:coupled_plant_no_rot
\begin{equation}
\begin{bmatrix} d_u \\ d_v \end{bmatrix} =
\frac{\frac{1}{k}}{\frac{s^2}{{\omega_0}^2} + 1}
\begin{bmatrix}
  1 & 0 \\
  0 & 1
\end{bmatrix}
\begin{bmatrix} F_u \\ F_v \end{bmatrix}
\end{equation}

# Campbell Diagram

When the rotation speed in not null, the resonance frequency is duplicated into two pairs of complex conjugate poles.
As the rotation speed increases, one of the two resonant frequency goes to lower frequencies as the other one goes to higher frequencies (Figure [[fig:campbell_diagram]]).

#+name: fig:campbell_diagram
#+caption: Campbell Diagram : Evolution of the poles as a function of the rotational speed $\Omega$
#+attr_latex: :environment subfigure :width 0.4\linewidth :align c
| file:figs/campbell_diagram_real.pdf     | file:figs/campbell_diagram_imag.pdf          |
| <<fig:campbell_diagram_real>> Real Part | <<fig:campbell_diagram_imag>> Imaginary Part |


# #+name: fig:campbell_diagram
# #+caption: Campbell Diagram
# #+attr_latex: :scale 1
# [[file:figs/campbell_diagram.pdf]]

# Bode Plots for different ratio wr/w0

The magnitude of the coupling terms are increasing with the rotation speed.

#+name: fig:plant_compare_rotating_speed
#+caption: Bode Plots for $\bm{G}_d$
#+attr_latex: :environment subfigure :width 0.45\linewidth :align c
| file:figs/plant_compare_rotating_speed_direct.pdf                             | file:figs/plant_compare_rotating_speed_coupling.pdf                               |
| <<fig:plant_compare_rotating_speed_direct>> Direct Terms $d_u/F_u$, $d_v/F_v$ | <<fig:plant_compare_rotating_speed_coupling>> Coupling Terms $d_v/F_u$, $d_u/F_v$ |

# #+name: fig:plant_compare_rotating_speed
# #+caption: Caption
# #+attr_latex: :scale 1
# [[file:figs/plant_compare_rotating_speed.pdf]]

* Integral Force Feedback
** Control Schematic

Force Sensors are added in series with the actuators as shown in Figure [[fig:system_iff]].

# Reference to IFF control

#+name: fig:system_iff
#+caption: System with Force Sensors in Series with the Actuators. Decentralized Integral Force Feedback is used
#+attr_latex: :scale 1
[[file:figs/system_iff.pdf]]

** Equations
The sensed forces are equal to:
\begin{equation}
\begin{bmatrix} f_{u} \\ f_{v} \end{bmatrix} =
\begin{bmatrix} F_u \\ F_v \end{bmatrix} - (c s + k)
\begin{bmatrix} d_u \\ d_v \end{bmatrix}
\end{equation}

Which then gives:
\begin{equation}
\begin{bmatrix} f_{u} \\ f_{v} \end{bmatrix} =
\bm{G}_{f}
\begin{bmatrix} F_u \\ F_v \end{bmatrix}
\end{equation}

\begin{equation}
\begin{bmatrix} f_{u} \\ f_{v} \end{bmatrix} =
\frac{1}{G_{fp}}
\begin{bmatrix}
  G_{fz} & -G_{fc} \\
  G_{fc} &  G_{fz}
\end{bmatrix}
\begin{bmatrix} F_u \\ F_v \end{bmatrix}
\end{equation}

\begin{align}
  G_{fp} &= \left( \frac{s^2}{{\omega_0}^2} + 2 \xi \frac{s}{\omega_0} + 1 - \frac{{\Omega}^2}{{\omega_0}^2} \right)^2 + \left( 2 \frac{\Omega}{\omega_0} \frac{s}{\omega_0} \right)^2 \\
  G_{fz} &= \left( \frac{s^2}{{\omega_0}^2} - \frac{\Omega^2}{{\omega_0}^2} \right) \left( \frac{s^2}{{\omega_0}^2} + 2 \xi \frac{s}{\omega_0} + 1 - \frac{{\Omega}^2}{{\omega_0}^2} \right) + \left( 2 \frac{\Omega}{\omega_0} \frac{s}{\omega_0} \right)^2 \\
  G_{fc} &= \left( 2 \xi \frac{s}{\omega_0} + 1 \right) \left( 2 \frac{\Omega}{\omega_0} \frac{s}{\omega_0} \right)
\end{align}

** Plant Dynamics

#+name: fig:plant_iff_compare_rotating_speed
#+caption: Bode plot of $\bm{G}_f$ for several rotational speeds $\Omega$
#+attr_latex: :scale 1
[[file:figs/plant_iff_compare_rotating_speed.pdf]]

# Show that the low frequency gain is no longer zero

# Write the analytical value of the low frequency gain

# Explain the two real zeros => change of gain but not of phase

# Explain physically why

** Integral Force Feedback

# General explanation for the Root Locus Plot

# MIMO root locus: gain is simultaneously increased for both decentralized controllers

# Explain the circles, crosses and black crosses (poles of the controller)

#+name: fig:root_locus_pure_iff
#+caption: Root Locus for the Decentralized Integral Force Feedback
#+attr_latex: :scale 1
[[file:figs/root_locus_pure_iff.pdf]]

# Physical Interpretation

At low frequency, the gain is very large and thus no force is transmitted between the payload and the rotating stage.
This means that at low frequency, the system is decoupled (the force sensor removed) and thus the system is unstable.

# Introduce next two sections where either:
# - IFF is modified to deal with this low frequency behavior
# - physical system is modified

* Integral Force Feedback with High Pass Filters
** Modification of the Control Low
# Reference to Preumont where its done


# Equation with the new control law


# Explain why it is usually done and why it is done here: the problem is the high gain at low frequency => high pass filter


** Feedback Analysis

# Explain that now the low frequency loop gain does not reach a gain more than 1 (if g not so high)

#+name: fig:loop_gain_modified_iff
#+caption: Bode Plot of the Loop Gain for IFF with and without the HPF
#+attr_latex: :scale 1
[[file:figs/loop_gain_modified_iff.pdf]]

# Not the system can be stable for small values of g
# Actually, the system becomes unstable for g > ...

#+name: fig:root_locus_modified_iff
#+caption: Root Locus for IFF with and without the HPF
#+attr_latex: :scale 1
[[file:figs/root_locus_modified_iff.pdf]]

** Optimal Cut-Off Frequency

# Controller: two parameters: gain and wi

# Try few wi

# Small wi seems to allow more damping to be added
# but the gain is limited to small values

# Trade off

#+name: fig:root_locus_wi_modified_iff
#+caption: Root Locus for several HPF cut-off frequencies $\omega_i$
#+attr_latex: :scale 1
[[file:figs/root_locus_wi_modified_iff.pdf]]

# Study this trade-off

# Explain how the figure is obtained

# for small wi => gain limited
# for large wi => damping limited
# wi = 0.1 w0 is chosen

#+name: fig:mod_iff_damping_wi
#+caption: Attainable damping ratio $\xi_\text{cl}$ as a function of the HPF cut-off frequency. Corresponding control gain $g_\text{opt}$ and $g_\text{max}$ are also shown
#+attr_latex: :scale 1
[[file:figs/mod_iff_damping_wi.pdf]]

* Integral Force Feedback with Parallel Springs
** Stiffness in Parallel with the Force Sensor

# Zeros = remove force sensor
# We want to have stable zeros => add stiffnesses in parallel

#+name: fig:system_parallel_springs
#+caption: System with added springs $k_p$ in parallel with the actuators
#+attr_latex: :scale 1
[[file:figs/system_parallel_springs.pdf]]

# Maybe add the fact that this is equivalent to amplified piezo for instance

# Equations: sensed force

# New parameters

** Effect of the Parallel Stiffness on the Plant Dynamics

# Negative Stiffness due to rotation => the stiffness should be larger than that

# For kp < negative stiffness => real zeros
# For kp > negative stiffness => complex conjugate zeros

#+name: fig:plant_iff_kp
#+caption: Bode Plot of $f_u/F_u$ without parallel spring, with parallel springs with stiffness $k_p < m \Omega^2$ and $k_p > m \Omega^2$
#+attr_latex: :scale 1
[[file:figs/plant_iff_kp.pdf]]

# Location of the zeros as a function of kp

# Show that it is the case on the root locus

#+name: fig:root_locus_iff_kp
#+caption: Root Locus for IFF without parallel spring, with parallel springs with stiffness $k_p < m \Omega^2$ and $k_p > m \Omega^2$
#+attr_latex: :scale 1
[[file:figs/root_locus_iff_kp.pdf]]

# For kp > m Omega => unconditionally stable

** Optimal Parallel Stiffness

# Explain that we have k = ka + kp constant in order to have the same resonance


# Large Stiffness decreases the attainable damping

#+name: fig:root_locus_iff_kps
#+caption: Root Locus for IFF for several parallel spring stiffnesses $k_p$
#+attr_latex: :scale 1
[[file:figs/root_locus_iff_kps.pdf]]


# Example with kp = 5 m Omega

#+name: fig:root_locus_opt_gain_iff_kp
#+caption: Root Locus for IFF with $k_p = 5 m \Omega^2$. The poles of the system using the gain that yields the maximum damping ratio are shown by black crosses
#+attr_latex: :scale 1
[[file:figs/root_locus_opt_gain_iff_kp.pdf]]

* Direct Velocity Feedback
** Control Schematic

# Basic Idea of DVF


# Equation with the control law

#+name: fig:system_dvf
#+caption: System with relative velocity sensors and with decentralized controllers $K_V$
#+attr_latex: :scale 1
[[file:figs/system_dvf.pdf]]

# Equivalent System is the same as Figure 1 (as increasing "c")

# Thus very much equivalent as adding passive elements such as dashpot

** Equations

# Write the equations


# Show that the rotation have somehow less impact on the plant than for IFF


# Eventually add a bode plot to show the effect of the rotation speed


** Relative Direct Velocity Feedback

# Unconditionally stable

# Arbitrary Damping can be added to the poles

#+name: fig:root_locus_dvf
#+caption: Root Locus for Decentralized Direct Velocity Feedback for several rotational speeds $\Omega$
#+attr_latex: :scale 1
[[file:figs/root_locus_dvf.pdf]]

* Comparison of the Proposed Active Damping Techniques for Rotating Positioning Stages
** Physical Comparison



** Attainable Damping

#+name: fig:comp_root_locus
#+caption: Root Locus for the three proposed decentralized active damping techniques: IFF with HFP, IFF with parallel springs, and relative DVF
#+attr_latex: :scale 1
[[file:figs/comp_root_locus.pdf]]


** Transmissibility and Compliance


# IFF with HPF and IFF with kp give very similar results

# Both techniques provides very good amount of damping

# IFF degrades the compliance at low frequency (add reference)

# Relative DVF degrades the transmissibility at high frequency
# The roll-off is -1 instead of -2

#+name: fig:comp_active_damping
#+caption: Comparison of the three proposed Active Damping Techniques
#+attr_latex: :environment subfigure :width 0.45\linewidth :align c
| file:figs/comp_compliance.pdf            | file:figs/comp_transmissibility.pdf      |
| <<fig:comp_compliance>> Transmissibility | <<fig:comp_transmissibility>> Compliance |

# #+name: fig:comp_compliance
# #+caption: Figure caption
# #+attr_latex: :scale 1
# [[file:figs/comp_compliance.pdf]]

# #+name: fig:comp_transmissibility
# #+caption: Figure caption
# #+attr_latex: :scale 1
# [[file:figs/comp_transmissibility.pdf]]

* Conclusion
<<sec:conclusion>>

* Acknowledgment
:PROPERTIES:
:UNNUMBERED: t
:END:

* Bibliography                                                        :ignore:
\bibliography{ref.bib}
